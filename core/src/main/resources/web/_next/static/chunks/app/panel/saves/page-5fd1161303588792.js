(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2630],{33963:(e,s,a)=>{Promise.resolve().then(a.bind(a,59980))},59980:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>O});var t=a(95155),l=a(12115),r=a(4648),n=a(29869),i=a(56671),d=a(24232),c=a(91788),o=a(55702),x=a(62525),u=a(42757),h=a.n(u),m=a(88482),f=a(53999),p=a(95011),j=a(88145),g=a(37777),v=a(97168),b=a(31886),N=a(99211),w=a(71153),y=a(62177),z=a(48778),C=a(23291),k=a(41085),_=a(30070),A=a(95784),$=a(89852),M=a(19832);let P=w.z.object({displayName:w.z.string().nonempty("存档名称不得为空"),defaultGameMode:w.z.enum(Object.values(C.U))});function R(e){let{save:s,children:a,asChild:l}=e,r=(0,y.mN)({resolver:(0,z.u)(P),values:{displayName:(0,f.QM)(s.displayName),defaultGameMode:s.defaultGameMode}}),n=async e=>{try{e.displayName=(0,f.q3)(e.displayName),await (0,b.ow)("/api/saves/".concat(s.name),e),M.P.emit("refresh-data")}catch(e){(0,b.Kf)(e,"无法保存存档信息",[[401,"未登录"],[500,"服务器内部错误"]])}};return(0,t.jsxs)(k.cj,{children:[(0,t.jsx)(k.CG,{asChild:l,children:a}),(0,t.jsx)(k.h,{children:(0,t.jsx)(_.lV,{...r,children:(0,t.jsxs)("form",{className:"flex-1 flex flex-col",onSubmit:r.handleSubmit(n),children:[(0,t.jsxs)(k.Fm,{children:[(0,t.jsx)(k.qp,{children:"编辑存档"}),(0,t.jsx)(k.Qs,{children:"在此编辑该存档的信息。"})]}),(0,t.jsxs)("div",{className:"flex-1 px-4 flex flex-col gap-5",children:[(0,t.jsx)(_.zB,{control:r.control,name:"displayName",render:e=>{let{field:s}=e;return(0,t.jsxs)(_.eI,{children:[(0,t.jsx)(_.lR,{children:"存档名称"}),(0,t.jsx)(p.Z,{className:"text-center [&_*]:wrap-anywhere",children:s.value}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(_.MJ,{children:(0,t.jsx)($.p,{...s,placeholder:"请输入存档名称...",autoFocus:!0,autoComplete:"off"})}),(0,t.jsx)(v.$,{variant:"outline",size:"icon",className:"cursor-pointer",onClick:e=>{e.preventDefault(),r.setValue("displayName",s.value+"\xa7")},children:"\xa7"})]}),(0,t.jsx)(_.C5,{})]})}}),(0,t.jsx)(_.zB,{control:r.control,name:"defaultGameMode",render:e=>{let{field:s}=e;return(0,t.jsxs)(_.eI,{children:[(0,t.jsx)(_.lR,{children:"默认游戏模式"}),(0,t.jsx)(_.MJ,{children:(0,t.jsxs)(A.l6,{...s,onValueChange:s.onChange,children:[(0,t.jsx)(A.bq,{className:"w-full",children:(0,t.jsx)(A.yv,{})}),(0,t.jsxs)(A.gC,{children:[(0,t.jsx)(A.eb,{value:"adventure",children:"冒险"}),(0,t.jsx)(A.eb,{value:"survival",children:"生存"}),(0,t.jsx)(A.eb,{value:"creative",children:"创造"}),(0,t.jsx)(A.eb,{value:"spectator",children:"旁观"})]})]})}),(0,t.jsx)(_.C5,{})]})}})]}),(0,t.jsxs)(k.XW,{children:[(0,t.jsx)(k.kN,{asChild:!0,children:(0,t.jsx)(v.$,{type:"submit",className:"cursor-pointer",children:"确定"})}),(0,t.jsx)(k.kN,{asChild:!0,children:(0,t.jsx)(v.$,{variant:"outline",className:"cursor-pointer",children:"取消"})})]})]})})})]})}function S(e){let{save:s,className:a}=e,{name:l,displayName:r,path:n,size:d,isRunning:u,isCurrent:w,defaultGameMode:y}=s,z=async()=>{let e=await (0,b.RT)("/api/saves/".concat(l));h()(e,"".concat(l,".zip"),"application/zip")},C=async()=>{try{await (0,b.nl)("/api/saves/".concat(l)),M.P.emit("refresh-data")}catch(e){i.oR.error("无法删除存档 ".concat(l),{description:e.message})}},k=async()=>{if(!w)try{await (0,b.ow)("/api/control/world?save=".concat(l)),M.P.emit("refresh-data"),i.oR.success("切换成功",{description:u?"当前存档正在运行":"重启服务器以使改动生效"})}catch(e){(0,b.Kf)(e,"无法切换当前存档",[[400,"请求参数错误"],[401,"未登录"],[404,"找不到该存档"],[500,"服务器内部错误"]])}};return(0,t.jsxs)(m.Zp,{className:(0,f.cn)("rounded-md min-h-fit px-3 py-3 flex flex-col justify-between hover:bg-muted",w&&"bg-green-50 hover:bg-background border-green-600 dark:bg-green-950 dark:border-green-900",a),children:[(0,t.jsxs)(g.m_,{children:[(0,t.jsx)(g.k$,{asChild:!0,children:(0,t.jsxs)("div",{className:"w-full flex flex-col gap-1 px-1 overflow-hidden cursor-pointer",onClick:()=>k(),children:[(0,t.jsx)(p.Z,{className:"wrap-anywhere",children:(0,f.QM)(r)}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground w-full overflow-hidden whitespace-nowrap text-ellipsis",children:l})]})}),(0,t.jsx)(g.ZI,{children:n})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"flex items-center flex-wrap gap-3 pl-1",children:[(0,t.jsx)("span",{className:"text-sm",children:(0,f.Cq)(y)}),u&&(0,t.jsxs)(j.E,{variant:"outline",className:"h-fit border-emerald-700 dark:border-green-900",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-600"}),"正在运行"]}),(0,t.jsx)("span",{className:"mr-2 text-sm text-muted-foreground font-[Consolas]",children:(0,f.$c)(d)})]}),(0,t.jsxs)("div",{className:"flex self-end [&_button]:cursor-pointer",children:[w?(0,t.jsx)(N.F,{title:'确定要保存并下载当前存档 "'.concat(l,'" 吗？'),description:"将要下载的存档是当前服务器正在运行的存档，在处理存档前服务器会对存档进行保存，此操作可能影响服务器性能。",onAction:()=>i.oR.promise(z(),{loading:"正在处理文件...",error:"无法下载存档 ".concat(l,".zip")}),asChild:!0,children:(0,t.jsx)(v.$,{variant:"ghost",size:"icon",title:"下载存档",children:(0,t.jsx)(c.A,{})})}):(0,t.jsx)(v.$,{variant:"ghost",size:"icon",title:"下载存档",onClick:()=>i.oR.promise(z(),{loading:"正在处理文件...",error:"无法下载存档 ".concat(l,".zip")}),children:(0,t.jsx)(c.A,{})}),(0,t.jsx)(R,{save:s,asChild:!0,children:(0,t.jsx)(v.$,{variant:"ghost",size:"icon",title:"编辑存档",children:(0,t.jsx)(o.A,{})})}),(0,t.jsx)(N.F,{title:'确定要删除存档 "'.concat(l,'" 吗？'),description:"此操作不可逆，被删除的存档将无法恢复。",onAction:()=>C(),asChild:!0,children:(0,t.jsx)(v.$,{variant:"ghost",size:"icon",disabled:u||w,title:"删除存档",children:(0,t.jsx)(x.A,{})})})]})]})]})}var q=a(55863);function D(e){let{className:s,value:a,...l}=e;return(0,t.jsx)(q.bL,{"data-slot":"progress",className:(0,f.cn)("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",s),...l,children:(0,t.jsx)(q.C1,{"data-slot":"progress-indicator",className:"bg-green-700 dark:bg-green-600 h-full w-full flex-1 transition-all",style:{transform:"translateX(-".concat(100-(a||0),"%)")}})})}var E=a(16559),L=a(82714);function O(){let[e,s]=(0,l.useState)([]),[a,c]=(0,l.useState)(!1),[o,x]=(0,l.useState)(null),[u,h]=(0,l.useState)(null),[m,p]=(0,l.useState)(!1),j=async()=>{try{let e=await (0,b.qV)("/api/saves");s(e.saves)}catch(e){(0,b.Kf)(e,"无法获取存档列表",[[400,"请求参数错误"],[401,"未登录"]])}},g=async e=>{if(c(!1),!e.name.endsWith(".zip"))return void i.oR.error("无法上传存档",{description:"存档格式不正确，请上传一个zip文件"});x(e.name);try{await (0,b.QM)("/api/saves",e,e=>{h(e<1?e:null)}),j()}catch(e){(0,b.Kf)(e,"上传失败",[[400,"存档格式不正确，请上传一个包含地图存档的zip文件"],[401,"未登录"],[403,"检测到非法压缩包"],[409,"存档名称冲突"],[500,"服务器内部错误"]])}};return(0,l.useEffect)(()=>{j(),M.P.on("refresh-data",()=>j())},[]),(0,t.jsxs)(d.SubPage,{title:"存档",icon:(0,t.jsx)(r.A,{}),className:"relative h-full z-20",onDragEnter:()=>c(!0),children:[(0,t.jsxs)("div",{className:(0,f.cn)("absolute top-0 left-0 right-0 bottom-16 flex flex-col justify-center items-center gap-4",a?"":"hidden"),children:[(0,t.jsx)("div",{className:"absolute w-full h-full border-4 rounded-sm border-dashed",onDrop:e=>{e.preventDefault(),g(e.dataTransfer.files[0])},onDragOver:e=>e.preventDefault(),onDragLeave:()=>c(!1)}),(0,t.jsx)(n.A,{size:60,stroke:"var(--color-muted-foreground)"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"将地图文件拖拽至此处以上传"})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex justify-between max-lg:flex-col max-lg:gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground max-md:hidden",children:"将存档压缩包 (zip格式) 拖入页面以进行导入。若存档压缩包内包含单个存档文件夹，则压缩包名称需与文件夹名称一致，否则拒绝导入。"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"点击存档名以切换当前存档，切换后需重启服务器使改动生效。"})]}),u&&(0,t.jsxs)("div",{className:"w-72 self-end max-md:w-full flex flex-col justify-end items-end gap-2",children:[(0,t.jsxs)("span",{children:["正在上传 ",o,"..."]}),(0,t.jsx)(D,{value:100*u,className:"h-1"})]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-end",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"所有存档"}),(0,t.jsxs)(E.Lt,{open:m,onOpenChange:p,children:[(0,t.jsx)(E.tv,{asChild:!0,children:(0,t.jsxs)(v.$,{className:"cursor-pointer",children:[(0,t.jsx)(n.A,{}),"上传"]})}),(0,t.jsxs)(E.EO,{children:[(0,t.jsxs)(E.wd,{children:[(0,t.jsx)(E.r7,{children:"上传存档"}),(0,t.jsx)(E.$v,{children:"在此上传存档。若存档压缩包内包含单个存档文件夹，则压缩包名称需与文件夹名称一致，否则拒绝导入。"})]}),(0,t.jsx)(L.J,{children:"存档 (zip格式)"}),(0,t.jsx)($.p,{type:"file",onChange:e=>{let s=e.target.files;s&&g(s[0]),p(!1)}}),(0,t.jsx)(E.ck,{children:(0,t.jsx)(E.Zr,{children:"关闭"})})]})]})]}),(0,t.jsx)("div",{className:"pt-2 grid grid-cols-3 max-xl:grid-cols-2 max-lg:flex flex-col gap-4",children:e.map((e,s)=>(0,t.jsx)(S,{save:e},s))})]})]})}},95784:(e,s,a)=>{"use strict";a.d(s,{bq:()=>x,eb:()=>h,gC:()=>u,l6:()=>c,yv:()=>o});var t=a(95155);a(12115);var l=a(14582),r=a(66474),n=a(5196),i=a(47863),d=a(53999);function c(e){let{...s}=e;return(0,t.jsx)(l.bL,{"data-slot":"select",...s})}function o(e){let{...s}=e;return(0,t.jsx)(l.WT,{"data-slot":"select-value",...s})}function x(e){let{className:s,size:a="default",children:n,...i}=e;return(0,t.jsxs)(l.l9,{"data-slot":"select-trigger","data-size":a,className:(0,d.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...i,children:[n,(0,t.jsx)(l.In,{asChild:!0,children:(0,t.jsx)(r.A,{className:"size-4 opacity-50"})})]})}function u(e){let{className:s,children:a,position:r="popper",...n}=e;return(0,t.jsx)(l.ZL,{children:(0,t.jsxs)(l.UC,{"data-slot":"select-content",className:(0,d.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:r,...n,children:[(0,t.jsx)(m,{}),(0,t.jsx)(l.LM,{className:(0,d.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),(0,t.jsx)(f,{})]})})}function h(e){let{className:s,children:a,...r}=e;return(0,t.jsxs)(l.q7,{"data-slot":"select-item",className:(0,d.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",s),...r,children:[(0,t.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,t.jsx)(l.VF,{children:(0,t.jsx)(n.A,{className:"size-4"})})}),(0,t.jsx)(l.p4,{children:a})]})}function m(e){let{className:s,...a}=e;return(0,t.jsx)(l.PP,{"data-slot":"select-scroll-up-button",className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,t.jsx)(i.A,{className:"size-4"})})}function f(e){let{className:s,...a}=e;return(0,t.jsx)(l.wn,{"data-slot":"select-scroll-down-button",className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,t.jsx)(r.A,{className:"size-4"})})}}},e=>{e.O(0,[6399,9994,8511,5702,5452,9641,3207,6671,3464,371,5299,3238,193,7478,8441,5964,7358],()=>e(e.s=33963)),_N_E=e.O()}]);